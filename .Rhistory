if ("V2" %in% names(dfw)) {
dfw$V2 <- as.integer(dfw$V2) - 1L
dfw$V2[dfw$V2 < 0L] <- 0L
}
}
utils::write.table(dfw, file_genes, sep = "\t", quote = FALSE,
row.names = FALSE, col.names = FALSE)
out_list_genes[[strain]] <- df_genes
if (isTRUE(create_dataframes)) {
assign(paste0(stem_genes, "_BED"), df_genes, envir = .GlobalEnv)
}
}
}
}
invisible(list(ranges = out_list_ranges, genes = out_list_genes))
}
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vInput,
out_dir       = "csaw_beds/TEST",
prefix        = "Kac_gained_K27promTSS",
mode          = "region",
direction     = "positive",
min_value     = 0.75,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vInput,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_allgenes_vInput",
mode          = "region",
direction     = "positive",
min_value     = 0.75,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
View(H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED)
#Subset files from bed file function (later in script). Here, I am pulling out all genes that don't have H3K36 in ash-1, and that aren't in K27 regions
###NOTE: I CALCULATED OVER THE WHOLE GENE BODY HERE
gr_wt   <- GRanges(H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$start,
H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$end))
gr_ash1 <- GRanges(H3K36me3_allgenes_vInput_log2FC_0.75_ash1_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_0.75_ash1_BED$start,
H3K36me3_allgenes_vInput_log2FC_0.75_ash1_BED$end))
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vInput,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_allgenes_vInput",
mode          = "region",
direction     = "positive",
min_value     = 1,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
#Subset files from bed file function (later in script). Here, I am pulling out all genes that don't have H3K36 in ash-1, and that aren't in K27 regions
###NOTE: I CALCULATED OVER THE WHOLE GENE BODY HERE
gr_wt   <- GRanges(H3K36me3_allgenes_vInput_log2FC_1_WT_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_1_WT_BED$start,
H3K36me3_allgenes_vInput_log2FC_1_WT_BED$end))
gr_ash1 <- GRanges(H3K36me3_allgenes_vInput_log2FC_1_ash1_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_1_ash1_BED$start,
H3K36me3_allgenes_vInput_log2FC_1_ash1_BED$end))
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_log2FC_1_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vInput,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_allgenes_vInput",
mode          = "region",
direction     = "positive",
min_value     = 0.8,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
#Subset files from bed file function (later in script). Here, I am pulling out all genes that don't have H3K36 in ash-1, and that aren't in K27 regions
###NOTE: I CALCULATED OVER THE WHOLE GENE BODY HERE
gr_wt   <- GRanges(H3K36me3_allgenes_vInput_log2FC_0.8_WT_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_0.8_WT_BED$start,
H3K36me3_allgenes_vInput_log2FC_0.8_WT_BED$end))
gr_ash1 <- GRanges(H3K36me3_allgenes_vInput_log2FC_0.8_ash1_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_0.8_ash1_BED$start,
H3K36me3_allgenes_vInput_log2FC_0.8_ash1_BED$end))
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_log2FC_0.8_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
View(WT_not_in_ash1)
#Subset files from bed file function (later in script). Here, I am pulling out all genes that don't have H3K36 in ash-1, and that aren't in K27 regions
###NOTE: I CALCULATED OVER THE WHOLE GENE BODY HERE
gr_wt   <- GRanges(H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$seqnames,
IRanges(H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$start,
H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED$end))
WT_not_in_ash1 <- H3K36me3_allgenes_vInput_log2FC_0.75_WT_BED[countOverlaps(gr_wt, gr_ash1) == 0, ]
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(H3K36me3_lost_genes_log2FC_1_ash1_genes_BED, H3K36me3_lost_genes_log2FC_1_ash1_genes_BED$V10 %in% regions$allgenes$V10 )
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vWT,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_lost_genes_vWT",
mode          = "region",
direction     = "positive",
min_value     = 1,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vWT,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_lost_genes_vWT",
mode          = "region",
direction     = "positive",
min_value     = 0.75,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
View(H3K36me3_Heatmap_allgenes_vWT)
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vWT,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_lost_genes_vWT",
mode          = "region",
direction     = "negative",
min_value     = 1,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
View(H3K36me3_lost_genes_vWT_log2FC_1_ash1_genes_BED)
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vWT,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_lost_genes_vWT",
mode          = "region",
direction     = "negative",
min_value     = 2,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
# Example 2: vInput heatmap, enriched regions per strain across a pre-determined region set (i.e. all genes)
peaks <- heatmap_to_bed_peaks(
hm_df         = H3K36me3_Heatmap_allgenes_vWT,
out_dir       = "csaw_beds/TEST",
prefix        = "H3K36me3_lost_genes_vWT",
mode          = "region",
direction     = "negative",
min_value     = 1.5,
merge_windows = FALSE,                     # ignored in region mode anyway
zero_based    = FALSE,
file_norm_tag = NULL,                      # OR "vInput"/"vWT" if you want it appended here
source_regions_df = regions$allgenes, # needs to match your original region df with coords + gene IDs
source_key_cols   = c("V1","V2","V3"),
source_gene_col   = "gene_id",      # may want to use V11, which has NCUs instead of names (change below)
promote_to_full_genes  = TRUE,
universe_df            = regions$allgenes, #IMPORTANT: The df you want to subset
universe_gene_col      = "gene_id",
universe_label         = "genes",
universe_is_zero_based = FALSE,
create_dataframes      = TRUE
)
View(H3K36me3_lost_genes_vWT_log2FC_1.5_ash1_BED)
View(H3K36me3_lost_genes_vWT_log2FC_1.5_ash1_genes_BED)
View(H3K36me3_Results_allgenes_vInput)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 1, FALSE)))
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0.75, FALSE)))
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
View(K36_enriched_genes)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
save.image("C:/Users/eddie/Research/GitHub/Research/csaw_working.RData")
rm(list = ls(pattern = "^H3K36me3_lost_gene"))    # all starting with "tmp_"
rm(list = ls(pattern = "^H3K36me3_allgenes_vInput_log"))    # all starting with "tmp_"
#I now have to sort each new subset df separately based on enrichment in desired sample (WT or mutant), then I have to extract the original sorted # to properly sort them on the final heatmap. This is probably a backwards way to do this.
no_caf_sort <- no_caf[no_caf_order, ]
no_cac3_sort <- no_cac3[no_cac3_order, ]
#Manual Clustering to clean up heatmap
no_caf <- subset(K27_FilteredHeatmap_mat, K27_FilteredHeatmap_mat[, 2] <= 0.1 & ! K27_FilteredHeatmap_mat[, 1] <= 0.1 & K27_FilteredHeatmap_mat[, 3] <= 0.1 & K27_FilteredHeatmap_mat[, 4] <= 0.1 )
save.image("C:/Users/eddie/Research/GitHub/Research/csaw_work.RData")
ls
H3K36me3_no_ash1 = subset(regions$allgenes, regions$allgenes$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#K27
K27_enriched_genes <- H3K27me3_CS_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
#K27
K27_enriched_genes <- H3K27me3_CS_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 1, FALSE)))
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gen_id )
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(regions$allgenes, regions$allgenes$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gene_id )
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% K27_enriched_genes$gene_id)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id )
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% K27_enriched_genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(regions$allgenes, regions$allgenes$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id )
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_gene, K36_enriched_gene$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$gene_id %in% K36_enriched_genes$gene_id & H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#K27
K27_enriched_genes <- H3K27me3_CS_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 2, FALSE)))
#K27
K27_enriched_genes <- H3K27me3_CS_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 1, FALSE)))
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
View(H3K36me3_no_ash1_nonK27)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.75)
View(H3K36me3_no_ash1)
View(H3K36me3_no_ash1)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.75)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < 0)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
View(H3K36me3_no_ash1_nonK27)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
View(H3K36me3_no_ash1_nonK27)
H3K36me3_no_ash1 = subset(regions$allgenes, regions$allgenes$logFC_ash1 < -0.585)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(regions$allgenes, H3K36me3_Results_allgenes_vWT$logFC_ash1 < -0.585)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(regions$allgenes, ! regions$allgenes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! regions$allgenes$gene_id %in% regions$K27genes$gene_id)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < 0)
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
H3K36me3_no_ash1_TEST = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gene_id)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
H3K36me3_no_ash1_TEST = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
View(K36_enriched_genes)
#ash-1 methylated genes
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
#ash-1 methylated, non-K27
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
H3K36me3_no_ash1_TEST = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gene_id)
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < 0)
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
View(H3K36me3_no_ash1_nonK27)
H3K36me3_no_ash1 = subset(K36_enriched_genes, K36_enriched_genes$logFC_ash1 < -0.585)
H3K36me3_no_ash1_nonK27 = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% regions$K27genes$gene_id)
H3K36me3_no_ash1_TEST = subset(H3K36me3_no_ash1, ! H3K36me3_no_ash1$gene_id %in% K27_enriched_genes$gene_id)
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
##############################
#determining genes enriched for H3K36me3 in WT (log2FC > 1 over input)
K36_enriched_genes <- H3K36me3_Results_allgenes_vInput %>%
filter(if_any(all_of(c(6)), ~ coalesce(.x > 0, FALSE)))
#Not ash-1 methylated
H3K36me3_set2_meth <- subset(K36_enriched_genes, ! K36_enriched_genes$gene_id %in% H3K36me3_no_ash1$gene_id & ! K36_enriched_genes$gene_id %in% regions$K27genes$gene_id)
#write files
write.table(H3K36me3_no_ash1_nonK27, file = "ash1_meth_nonK27_V2.bed", sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
write.table(H3K36me3_no_ash1_TEST, file = "ash1_meth_nonK27_TEST.bed", sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
write.table(H3K36me3_set2_meth, file = "set2_meth_only_V2.bed", sep = "\t", quote = FALSE, row.names = FALSE, col.names = FALSE)
#ash-1 methylated, non-K27, lost in CAF (going over TSS)
H3K36me3_no_ash1_no_CAF = subset(H3K36me3_Results_K27promTSS_vWT, H3K36me3_Results_K27promTSS_vWT$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id & (H3K36me3_Results_K27promTSS_vWT$logFC_cac1 < -0.75 | H3K36me3_Results_K27promTSS_vWT$logFC_cac2 < -0.75 ))
#ash-1 methylated, non-K27, lost in CAF (going over TSS)
H3K36me3_no_ash1_no_CAF = subset(H3K36me3_Results_K27promTSS_vWT, H3K36me3_Results_K27promTSS_vWT$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id)
#ash-1 methylated, non-K27, lost in CAF (going over TSS)
H3K36me3_no_ash1_no_CAF = subset(H3K36me3_Results_K27promTSS_vWT, H3K36me3_Results_K27promTSS_vWT$gene_id %in% H3K36me3_no_ash1_nonK27$gene_id)
#reading in regions of interest
regions <- list(allgenespromTSS = read.table("../allgenes_promTSS.bed") allgenes_promTSSext = read.table("../bed_files/allgenespromTSSext.bed"))
#reading in regions of interest
regions <- list(allgenespromTSS = read.table("../allgenes_promTSS.bed"), allgenes_promTSSext = read.table("../bed_files/allgenespromTSSext.bed"))
#reading in regions of interest
regions <- list(allgenespromTSS = read.table("../bed_files/allgenes_promTSS.bed"), allgenes_promTSSext = read.table("../bed_files/allgenespromTSSext.bed"))
View(regions)
#reading in metdata
meta <- read.csv("../csaw_samples_files/cac_csaw_FINAL.csv")
#fix path (if necessary, should only be if you're in wrong directory)
meta <- meta %>%
mutate(bamReads = paste0("../", bamReads))
#Build group factor from csaw metadata
grouping <- factor(paste(meta$Strain, meta$Antibody, sep = "."))
#Design matrix using this grouping for downstream comaprisons
design.mat <- model.matrix(~ 0 + grouping)
colnames(design.mat) <- levels(grouping)
###########remove mat locus               1856250. 1862401 36 - 37
matLocus <- GRanges("CM002236.1", IRanges(1856288, 1862459)) # mat
##set parameters for windowCounts
param <- readParam(discard = matLocus, pe="none", max.frag=1500, minq=20 )
#reading in regions of interest
regions <- list(allgenespromTSS = read.table("../bed_files/allgenes_promTSS.bed"), allgenes_promTSSext = read.table("../bed_files/allgenespromTSSext.bed"))
#K27genes_proms = read.table("../bed_files/K27_genes_prom_100pct_overlap.bed"), K27genes = read.table("../bed_files/K27_genes_stringent.bed"), K27proms = read.table("../bed_files/K27_promoters.bed"), K27promTSS = read.table("../bed_files/K27_prom_TSS.bed"), allgenes = read.table("../bed_files/all_genes_forR.bed"), K27promTSSext = read.table("../bed_files/K27promTSSext.bed"),
new = read.table("../bed_files/H3K27me3_methylated_genes_FINAL.bed")
#regions$K27promTSS = subset(regions$K27promTSS, regions$K27promTSS$V10 %in% new$V10)
#regions$K27proms = subset(regions$K27proms, regions$K27proms$V10 %in% new$V10)
#regions$K27genes_proms = subset(regions$K27genes_proms, regions$K27genes_proms$V10 %in% new$V10)
#regions$K27genes = subset(regions$K27genes, regions$K27genes$V10 %in% new$V10)
#regions$K27promTSSext = subset(regions$K27promTSSext, regions$K27promTSSext$V10 %in% new$V10)
###IMPORTANT: the tables you  read into your list should not have a header (i.e., the column names should be V1, V2, ... VX). If your columns have other names, the count function may not recognize it properly. even if the files you read in have headers, i believe you can adjust the way read.table reads it into a df object. check column names in the "regions" object before continuing
#with "list" you can read multiple beds into the function
#once you load in all the metadata and bed with regions, run the first function to count data and make a dge object
#This is where you change the parameters and run the function
count_results <- csaw_count_and_fit(
metadata_df = meta,
region_list = NULL,
mode = "region", #"region" or "window"
window_size = 300,
design_mat = design.mat,
param = param
)
#reading in metdata
meta <- read.csv("../csaw_samples_files/cac_csaw_FINAL.csv")
#fix path (if necessary, should only be if you're in wrong directory)
meta <- meta %>%
mutate(bamReads = paste0("../", bamReads))
#Build group factor from csaw metadata
grouping <- factor(paste(meta$Strain, meta$Antibody, sep = "."))
#Design matrix using this grouping for downstream comaprisons
design.mat <- model.matrix(~ 0 + grouping)
colnames(design.mat) <- levels(grouping)
###########remove mat locus               1856250. 1862401 36 - 37
matLocus <- GRanges("CM002236.1", IRanges(1856288, 1862459)) # mat
##set parameters for windowCounts
param <- readParam(discard = matLocus, pe="none", max.frag=1500, minq=20 )
#reading in regions of interest
regions <- list(allgenespromTSS = read.table("../bed_files/allgenes_promTSS.bed"), allgenes_promTSSext = read.table("../bed_files/allgenespromTSSext.bed"))
#K27genes_proms = read.table("../bed_files/K27_genes_prom_100pct_overlap.bed"), K27genes = read.table("../bed_files/K27_genes_stringent.bed"), K27proms = read.table("../bed_files/K27_promoters.bed"), K27promTSS = read.table("../bed_files/K27_prom_TSS.bed"), allgenes = read.table("../bed_files/all_genes_forR.bed"), K27promTSSext = read.table("../bed_files/K27promTSSext.bed"),
new = read.table("../bed_files/H3K27me3_methylated_genes_FINAL.bed")
#regions$K27promTSS = subset(regions$K27promTSS, regions$K27promTSS$V10 %in% new$V10)
#regions$K27proms = subset(regions$K27proms, regions$K27proms$V10 %in% new$V10)
#regions$K27genes_proms = subset(regions$K27genes_proms, regions$K27genes_proms$V10 %in% new$V10)
#regions$K27genes = subset(regions$K27genes, regions$K27genes$V10 %in% new$V10)
#regions$K27promTSSext = subset(regions$K27promTSSext, regions$K27promTSSext$V10 %in% new$V10)
###IMPORTANT: the tables you  read into your list should not have a header (i.e., the column names should be V1, V2, ... VX). If your columns have other names, the count function may not recognize it properly. even if the files you read in have headers, i believe you can adjust the way read.table reads it into a df object. check column names in the "regions" object before continuing
#with "list" you can read multiple beds into the function
#once you load in all the metadata and bed with regions, run the first function to count data and make a dge object
#This is where you change the parameters and run the function
count_results <- csaw_count_and_fit(
metadata_df = meta,
region_list = NULL,
mode = "region", #"region" or "window"
window_size = 300,
design_mat = design.mat,
param = param
)
#This is where you change the parameters and run the function
count_results <- csaw_count_and_fit(
metadata_df = meta,
region_list = regions,
mode = "region", #"region" or "window"
window_size = 300,
design_mat = design.mat,
param = param
)
save.image("C:/Users/eddie/Research/GitHub/Research/csaw_work.RData")
gc()
